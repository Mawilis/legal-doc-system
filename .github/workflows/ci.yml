# File: .github/workflows/ci.yml
# -----------------------------------------------------------------------------
# COLLABORATION NOTES:
# - Purpose: Continuous Integration pipeline for legal-doc-system.
# - Current job: ğŸ” Run Backend Tests (Mongo + Jest).
# - Added jobs: Lint (code quality) + Frontend Build (React).
# - Engineers:
#   â€¢ Keep Node versions aligned with dev/prod.
#   â€¢ Extend with deployment jobs as needed.
# -----------------------------------------------------------------------------

name: CI Pipeline

on:
  push:
    branches: [main]
  pull_request:
    branches: [main]

jobs:
  # --- Backend Tests ---
  backend-tests:
    name: ğŸ” Run Backend Tests
    runs-on: ubuntu-latest

    services:
      mongo:
        image: mongo:6
        ports:
          - 27017:27017

    env:
      MONGODB_URI: mongodb://localhost:27017/testdb
      JWT_SECRET: testjwtsecret
      ALERT_EMAIL: dev@example.com
      SKIP_CONNECT_DB: true
      NODE_ENV: test

    steps:
      - name: â¬‡ï¸ Checkout repository
        uses: actions/checkout@v4

      - name: ğŸŸ¢ Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: 20
          cache: 'npm'

      - name: ğŸ“¦ Install dependencies
        run: cd server && npm ci

      - name: âœ… Run tests
        run: cd server && npm test

  # --- Lint ---
  lint:
    name: ğŸ§¹ Lint Codebase
    runs-on: ubuntu-latest
    steps:
      - name: â¬‡ï¸ Checkout repository
        uses: actions/checkout@v4

      - name: ğŸŸ¢ Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: 20
          cache: 'npm'

      - name: ğŸ“¦ Install dependencies
        run: npm ci

      - name: ğŸ” Run ESLint
        run: npm run lint --if-present

  # --- Frontend Build ---
  frontend-build:
    name: ğŸ–¥ï¸ Build Frontend
    runs-on: ubuntu-latest
    steps:
      - name: â¬‡ï¸ Checkout repository
        uses: actions/checkout@v4

      - name: ğŸŸ¢ Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: 20
          cache: 'npm'

      - name: ğŸ“¦ Install dependencies
        run: cd client && npm ci

      - name: ğŸ› ï¸ Build React App
        run: cd client && npm run build
