%%{init: {'theme': 'dark', 'themeVariables': { 'primaryColor': '#1a1a2e', 'primaryTextColor': '#fff', 'primaryBorderColor': '#0ff', 'lineColor': '#0ff', 'secondaryColor': '#16213e', 'tertiaryColor': '#0f3460'}}}%%
graph TB
    subgraph "INVESTOR LAYER — ECONOMIC VALUE"
        direction LR
        Market[R770M TAM<br/>92% COST REDUCTION]
        Compliance[100% REGULATORY<br/>COVERAGE]
        Risk[R8.7M PENALTY<br/>ELIMINATED]
        ROI[3.8 MONTH<br/>PAYBACK]
    end

    subgraph "TEST SUITE — LPC RULE 41.3 FORENSIC VALIDATION"
        direction TB
        TestFile[__tests__/lpc/rule41.3.administrator-metrics.forensic.test.js<br/>6.0.1 INVESTOR RELEASE]
        
        TC001[TC-001: LPC_ADMIN ROLE VALIDATION<br/>LPC 41.3 + 8 NON-ADMIN ROLES DENIED]
        TC002[TC-002: TENANT ISOLATION<br/>LPC 86.5 + ZERO CROSS-TENANT LEAKAGE]
        TC003[TC-003: COMPREHENSIVE METRICS<br/>LPC 35.2 + 50+ METRICS ACROSS 6 DOMAINS]
        TC004[TC-004: BENCHMARKING<br/>SARB GN6.4 + PERCENTILE RANKING]
        TC005[TC-005: TREND ANALYSIS<br/>FSCA + 6-MONTH FORECASTING]
        TC006[TC-006: AUDIT TRAIL<br/>COMPLETE FORENSIC EVIDENCE]
        
        TestFile --> TC001
        TestFile --> TC002
        TestFile --> TC003
        TestFile --> TC004
        TestFile --> TC005
        TestFile --> TC006
    end

    subgraph "PRODUCTION CODE — METRICS ENGINE"
        direction TB
        LPCService[services/lpcService.js<br/>Administrator Metrics API]
        
        subgraph "DATA MODELS — 6 COMPLIANCE DOMAINS"
            AttorneyModel[models/AttorneyProfile.js<br/>20+ Attorneys per Tenant]
            TrustModel[models/TrustAccount.js<br/>Trust Account Compliance]
            CPDModel[models/CPDRecord.js<br/>CPD Activity Tracking]
            FidelityModel[models/FidelityFund.js<br/>Certificate Management]
            AuditModel[models/ComplianceAudit.js<br/>Audit Findings]
            TransactionModel[models/Transaction.js<br/>Financial Activity]
        end
        
        subgraph "UTILITIES — FORENSIC CORE"
            AuditLogger[utils/auditLogger.js<br/>LPC_41.3 Tagging]
            CryptoUtils[utils/cryptoUtils.js<br/>SHA3-512 Evidence Hashing]
            BenchmarkEngine[utils/benchmark.engine.js<br/>Percentile Calculation]
        end
        
        LPCService --> AttorneyModel
        LPCService --> TrustModel
        LPCService --> CPDModel
        LPCService --> FidelityModel
        LPCService --> AuditModel
        LPCService --> TransactionModel
        LPCService --> AuditLogger
        LPCService --> CryptoUtils
        LPCService --> BenchmarkEngine
    end

    subgraph "BENCHMARKING — INDUSTRY DISTRIBUTION"
        direction LR
        IndustryDist[1000 FIRM DATASET<br/>LPC 2026]
        PercentileCalc[Percentile Calculation<br/>0-100 Scale]
        Benchmarks[Industry Average: 78.5%<br/>Top Decile: 94.2%<br/>LPC Requirement: 70.0%]
        
        IndustryDist --> PercentileCalc
        PercentileCalc --> Benchmarks
    end

    subgraph "PREDICTIVE ANALYTICS — TREND FORECASTING"
        direction TB
        TrendData[6-Month Historical<br/>Compliance Data]
        Forecast[Predictive Model<br/>18.5% Improvement]
        Recommendations[Actionable Insights<br/>3+ per Tenant]
        
        TrendData --> Forecast
        Forecast --> Recommendations
    end

    subgraph "EVIDENCE & DOCUMENTATION — INVESTOR PACKAGE"
        direction TB
        EvidenceDir[/docs/evidence/<br/>lpc-41.3-*.forensic.json]
        LatestSymlink[/docs/evidence/<br/>lpc-41.3.latest.json]
        Diagrams[/docs/diagrams/<br/>lpc-rule41.3-metrics-architecture.mmd]
        Runbook[/runbooks/<br/>lpc-41.3-metrics-runbook.md]
        
        EvidenceDir --> LatestSymlink
    end

    TC001 -.-> LPCService
    TC002 -.-> LPCService
    TC003 -.-> AttorneyModel
    TC003 -.-> TrustModel
    TC003 -.-> CPDModel
    TC003 -.-> FidelityModel
    TC004 -.-> BenchmarkEngine
    TC005 -.-> LPCService
    TC006 -.-> AuditLogger
    
    LPCService -.-> EvidenceDir
    TestFile -.-> EvidenceDir
    
    EvidenceDir --> Market
    EvidenceDir --> Compliance
    EvidenceDir --> Risk
    EvidenceDir --> ROI
    
    classDef investor fill:#9932cc,stroke:#0ff,stroke-width:3px,color:#fff
    classDef test fill:#1e3a8a,stroke:#0f0,stroke-width:2px,color:#fff
    classDef prod fill:#0f3460,stroke:#ff0,stroke-width:2px,color:#fff
    classDef model fill:#16213e,stroke:#f0f,stroke-width:2px,color:#fff
    classDef benchmark fill:#4a1d2b,stroke:#ff6b6b,stroke-width:2px,color:#fff
    classDef evidence fill:#006d5b,stroke:#0ff,stroke-width:2px,color:#fff
    
    class Market,Compliance,Risk,ROI investor
    class TestFile,TC001,TC002,TC003,TC004,TC005,TC006 test
    class LPCService prod
    class AttorneyModel,TrustModel,CPDModel,FidelityModel,AuditModel,TransactionModel model
    class BenchmarkEngine,PercentileCalc,Benchmarks benchmark
    class EvidenceDir,LatestSymlink,Diagrams,Runbook evidence
